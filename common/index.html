<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@qiwi/masker-common</title><meta name="description" content="Documentation for @qiwi/masker-common"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@qiwi/masker-common</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@qiwi/masker-common</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#qiwimasker-common" id="qiwimasker-common" style="color: inherit; text-decoration: none;">
  <h1>@qiwi/masker-common</h1>
</a>
<p>Masker common components: interfaces, executor, utils</p>

<a href="#install" id="install" style="color: inherit; text-decoration: none;">
  <h2>Install</h2>
</a>
<pre><code class="language-shell"><span class="hl-0">yarn add @qiwi/masker-common</span>
</code></pre>

<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
  <h2>Usage</h2>
</a>

<a href="#context" id="context" style="color: inherit; text-decoration: none;">
  <h3>Context</h3>
</a>
<pre><code class="language-ts"><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-2">interface</span><span class="hl-0"> </span><span class="hl-3">IEnrichedContext</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-4">value</span><span class="hl-0">: </span><span class="hl-3">any</span><span class="hl-0">                </span><span class="hl-5">// value to process</span><br/><span class="hl-0">  </span><span class="hl-4">_value</span><span class="hl-0">?: </span><span class="hl-3">any</span><span class="hl-0">              </span><span class="hl-5">// pipe result</span><br/><span class="hl-0">  </span><span class="hl-4">id</span><span class="hl-0">: </span><span class="hl-3">IContextId</span><span class="hl-0">            </span><span class="hl-5">// ctx unique key</span><br/><span class="hl-0">  </span><span class="hl-4">context</span><span class="hl-0">: </span><span class="hl-3">IEnrichedContext</span><span class="hl-0"> </span><span class="hl-5">// ctx self ref</span><br/><span class="hl-0">  </span><span class="hl-4">parentId</span><span class="hl-0">?: </span><span class="hl-3">IContextId</span><span class="hl-0">     </span><span class="hl-5">// parent ctx id</span><br/><span class="hl-0">  </span><span class="hl-4">registry</span><span class="hl-0">: </span><span class="hl-3">IMaskerRegistry</span><span class="hl-0">       </span><span class="hl-5">// pipe registry attached to ctx</span><br/><span class="hl-0">  </span><span class="hl-4">execute</span><span class="hl-0">: </span><span class="hl-3">IEnrichedExecutor</span><span class="hl-0">      </span><span class="hl-5">// executor </span><br/><span class="hl-0">  </span><span class="hl-4">sync</span><span class="hl-0">: </span><span class="hl-3">boolean</span><span class="hl-0">                   </span><span class="hl-5">// sync / async switch</span><br/><span class="hl-0">  </span><span class="hl-4">mode</span><span class="hl-0">: </span><span class="hl-3">IExecutionMode</span><span class="hl-0">            </span><span class="hl-5">// lagacy sync switch</span><br/><span class="hl-0">  </span><span class="hl-4">opts</span><span class="hl-0">: </span><span class="hl-3">IMaskerOpts</span><span class="hl-0">               </span><span class="hl-5">// current pipe options</span><br/><span class="hl-0">  </span><span class="hl-4">pipe</span><span class="hl-0">?: </span><span class="hl-3">IMaskerPipeNormalized</span><span class="hl-0">              </span><span class="hl-5">// current pipe ref</span><br/><span class="hl-0">  </span><span class="hl-4">pipeline</span><span class="hl-0">: </span><span class="hl-3">IMaskerPipelineNormalized</span><span class="hl-0">       </span><span class="hl-5">// actual pipeline</span><br/><span class="hl-0">  </span><span class="hl-4">originPipeline</span><span class="hl-0">: </span><span class="hl-3">IMaskerPipelineNormalized</span><span class="hl-0"> </span><span class="hl-5">// origin pipeline</span><br/><span class="hl-0">  [</span><span class="hl-4">key</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">]: </span><span class="hl-3">any</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#createpipe" id="createpipe" style="color: inherit; text-decoration: none;">
  <h3>createPipe()</h3>
</a>
<p>Creates a pipe entity. Several pipes are combined into a <code>pipeline</code> to be processed by <code>executor</code>.</p>
<pre><code class="language-ts"><span class="hl-1">import</span><span class="hl-0"> {</span><span class="hl-4">createPipe</span><span class="hl-0">} </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-6">&#39;@qiwi/masker-common&#39;</span><br/><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-7">pipe</span><span class="hl-0"> = </span><span class="hl-8">createPipe</span><span class="hl-0">(</span><span class="hl-6">&#39;foo&#39;</span><span class="hl-0">, () </span><span class="hl-2">=&gt;</span><span class="hl-0"> ({</span><span class="hl-4">value:</span><span class="hl-0"> </span><span class="hl-6">&#39;syncfoo&#39;</span><span class="hl-0">}), </span><span class="hl-2">async</span><span class="hl-0"> () </span><span class="hl-2">=&gt;</span><span class="hl-0"> ({</span><span class="hl-4">value:</span><span class="hl-0"> </span><span class="hl-6">&#39;asyncfoo&#39;</span><span class="hl-0">}))</span><br/><br/><span class="hl-4">pipe</span><span class="hl-0">.</span><span class="hl-4">name</span><span class="hl-0">       </span><span class="hl-5">// &#39;foo&#39;</span><br/><span class="hl-4">pipe</span><span class="hl-0">.</span><span class="hl-8">sync</span><span class="hl-0">({})   </span><span class="hl-5">// {value: &#39;syncfoo&#39;}</span><br/><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-8">pipe</span><span class="hl-0">({})  </span><span class="hl-5">// {value: &#39;asyncfoo&#39;}</span>
</code></pre>

<a href="#getpipe" id="getpipe" style="color: inherit; text-decoration: none;">
  <h3>getPipe()</h3>
</a>
<p>Get pipe from registry.</p>
<pre><code class="language-ts"><span class="hl-1">import</span><span class="hl-0"> {</span><span class="hl-4">getPipe</span><span class="hl-0">, </span><span class="hl-4">crearePipe</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">cp</span><span class="hl-0">} </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-6">&#39;@qiwi/masker-common&#39;</span><br/><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-7">pipe</span><span class="hl-0"> = </span><span class="hl-8">cp</span><span class="hl-0">(</span><span class="hl-6">&#39;foo&#39;</span><span class="hl-0">, () </span><span class="hl-2">=&gt;</span><span class="hl-0"> ({</span><span class="hl-4">value:</span><span class="hl-0"> </span><span class="hl-6">&#39;foo&#39;</span><span class="hl-0">}))</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-7">registry</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-3">Map</span><span class="hl-0">()</span><br/><br/><span class="hl-4">registry</span><span class="hl-0">.</span><span class="hl-8">set</span><span class="hl-0">(</span><span class="hl-6">&#39;foo&#39;</span><span class="hl-0">, </span><span class="hl-4">pipe</span><span class="hl-0">)</span><br/><span class="hl-8">getPipe</span><span class="hl-0">(</span><span class="hl-6">&#39;foo&#39;</span><span class="hl-0">, </span><span class="hl-4">registry</span><span class="hl-0">) </span><span class="hl-5">// pipe</span>
</code></pre>

<a href="#execute" id="execute" style="color: inherit; text-decoration: none;">
  <h3>execute()</h3>
</a>
<p>The pipeline executor. Transforms the target value (ctx) via the handlers queue. Provides both sync and async modes.</p>
<pre><code class="language-ts"><span class="hl-1">import</span><span class="hl-0"> {</span><span class="hl-4">createPipe</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">cp</span><span class="hl-0">, </span><span class="hl-4">execute</span><span class="hl-0">} </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-6">&#39;@qiwi/masker-common&#39;</span><br/><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-7">pipe1</span><span class="hl-0"> = </span><span class="hl-8">cp</span><span class="hl-0">(</span><span class="hl-6">&#39;pipe1&#39;</span><span class="hl-0">, () </span><span class="hl-2">=&gt;</span><span class="hl-0"> ({</span><span class="hl-4">value:</span><span class="hl-0"> </span><span class="hl-6">&#39;pipe1&#39;</span><span class="hl-0">}))</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-7">pipe2</span><span class="hl-0"> = </span><span class="hl-8">cp</span><span class="hl-0">(</span><span class="hl-6">&#39;pipe2&#39;</span><span class="hl-0">, ({</span><span class="hl-4">value</span><span class="hl-0">}) </span><span class="hl-2">=&gt;</span><span class="hl-0"> ({</span><span class="hl-4">value:</span><span class="hl-0"> </span><span class="hl-4">value</span><span class="hl-0"> + </span><span class="hl-6">&#39;pipe2&#39;</span><span class="hl-0">}))</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-7">pipeline</span><span class="hl-0"> = [</span><span class="hl-4">pipe1</span><span class="hl-0">, </span><span class="hl-4">pipe2</span><span class="hl-0">]</span><br/><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-7">value</span><span class="hl-0"> = </span><span class="hl-6">&#39;foobar&#39;</span><br/><br/><span class="hl-5">// async</span><br/><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-8">execute</span><span class="hl-0">({</span><span class="hl-4">pipeline</span><span class="hl-0">, </span><span class="hl-4">value</span><span class="hl-0">})        </span><span class="hl-5">// {value: &#39;pipe1pipe2&#39;}</span><br/><br/><span class="hl-5">// sync</span><br/><span class="hl-8">execute</span><span class="hl-0">({</span><span class="hl-4">pipeline</span><span class="hl-0">, </span><span class="hl-4">value</span><span class="hl-0">, </span><span class="hl-4">sync:</span><span class="hl-0"> </span><span class="hl-2">true</span><span class="hl-0">})  </span><span class="hl-5">// {value: &#39;pipe1pipe2&#39;}</span><br/><span class="hl-4">execute</span><span class="hl-0">.</span><span class="hl-8">sync</span><span class="hl-0">({</span><span class="hl-4">pipeline</span><span class="hl-0">, </span><span class="hl-4">value</span><span class="hl-0">})         </span><span class="hl-5">// {value: &#39;pipe1pipe2&#39;}</span>
</code></pre>

<a href="#license" id="license" style="color: inherit; text-decoration: none;">
  <h2>License</h2>
</a>
<p><a href="https://github.com/qiwi/masker/blob/master/LICENSE">MIT</a></p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-interface"><a href="interfaces/IEnrichedContext.html" class="tsd-kind-icon">IEnriched<wbr/>Context</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/IEnrichedExecutor.html" class="tsd-kind-icon">IEnriched<wbr/>Executor</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/IExecutor.html" class="tsd-kind-icon">IExecutor</a></li><li class="tsd-kind-interface"><a href="interfaces/IMaskerFactoryOpts.html" class="tsd-kind-icon">IMasker<wbr/>Factory<wbr/>Opts</a></li><li class="tsd-kind-interface"><a href="interfaces/IMaskerPipe.html" class="tsd-kind-icon">IMasker<wbr/>Pipe</a></li><li class="tsd-kind-interface"><a href="interfaces/IMaskerPipeAsync.html" class="tsd-kind-icon">IMasker<wbr/>Pipe<wbr/>Async</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/IMaskerPipeDual.html" class="tsd-kind-icon">IMasker<wbr/>Pipe<wbr/>Dual</a></li><li class="tsd-kind-interface"><a href="interfaces/IMaskerPipeInput.html" class="tsd-kind-icon">IMasker<wbr/>Pipe<wbr/>Input</a></li><li class="tsd-kind-interface"><a href="interfaces/IMaskerPipeOutput.html" class="tsd-kind-icon">IMasker<wbr/>Pipe<wbr/>Output</a></li><li class="tsd-kind-interface"><a href="interfaces/IMaskerPipeSync.html" class="tsd-kind-icon">IMasker<wbr/>Pipe<wbr/>Sync</a></li><li class="tsd-kind-interface"><a href="interfaces/ISyncSensitive.html" class="tsd-kind-icon">ISync<wbr/>Sensitive</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IContextId" class="tsd-kind-icon">IContext<wbr/>Id</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IExecutorSync" class="tsd-kind-icon">IExecutor<wbr/>Sync</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IMasker" class="tsd-kind-icon">IMasker</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IMaskerOpts" class="tsd-kind-icon">IMasker<wbr/>Opts</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IMaskerPipeDeclaration" class="tsd-kind-icon">IMasker<wbr/>Pipe<wbr/>Declaration</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IMaskerPipeName" class="tsd-kind-icon">IMasker<wbr/>Pipe<wbr/>Name</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IMaskerPipeNormalized" class="tsd-kind-icon">IMasker<wbr/>Pipe<wbr/>Normalized</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IMaskerPipeOpts" class="tsd-kind-icon">IMasker<wbr/>Pipe<wbr/>Opts</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IMaskerPipeRef" class="tsd-kind-icon">IMasker<wbr/>Pipe<wbr/>Ref</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IMaskerPipeRefWithOpts" class="tsd-kind-icon">IMasker<wbr/>Pipe<wbr/>Ref<wbr/>With<wbr/>Opts</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IMaskerPipeline" class="tsd-kind-icon">IMasker<wbr/>Pipeline</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IMaskerPipelineNormalized" class="tsd-kind-icon">IMasker<wbr/>Pipeline<wbr/>Normalized</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IMaskerRegistry" class="tsd-kind-icon">IMasker<wbr/>Registry</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IRawContext" class="tsd-kind-icon">IRaw<wbr/>Context</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#ParseSync" class="tsd-kind-icon">Parse<wbr/>Sync</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#SyncGuard" class="tsd-kind-icon">Sync<wbr/>Guard</a></li><li class="tsd-kind-type-alias"><a href="modules.html#TExecutorHook" class="tsd-kind-icon">TExecutor<wbr/>Hook</a></li><li class="tsd-kind-type-alias"><a href="modules.html#THookCallback" class="tsd-kind-icon">THook<wbr/>Callback</a></li><li class="tsd-kind-type-alias"><a href="modules.html#TSyncDirective" class="tsd-kind-icon">TSync<wbr/>Directive</a></li><li class="tsd-kind-variable"><a href="modules.html#execute" class="tsd-kind-icon">execute</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#asArray" class="tsd-kind-icon">as<wbr/>Array</a></li><li class="tsd-kind-function"><a href="modules.html#asRegExp" class="tsd-kind-icon">as<wbr/>Reg<wbr/>Exp</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#asynchronize" class="tsd-kind-icon">asynchronize</a></li><li class="tsd-kind-function"><a href="modules.html#createMasker" class="tsd-kind-icon">create<wbr/>Masker</a></li><li class="tsd-kind-function"><a href="modules.html#createPipe" class="tsd-kind-icon">create<wbr/>Pipe</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#defineNonEnum" class="tsd-kind-icon">define<wbr/>Non<wbr/>Enum</a></li><li class="tsd-kind-function"><a href="modules.html#enrichExecutor" class="tsd-kind-icon">enrich<wbr/>Executor</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#execEcho" class="tsd-kind-icon">exec<wbr/>Echo</a></li><li class="tsd-kind-function"><a href="modules.html#generateId" class="tsd-kind-icon">generate<wbr/>Id</a></li><li class="tsd-kind-function"><a href="modules.html#getPipe" class="tsd-kind-icon">get<wbr/>Pipe</a></li><li class="tsd-kind-function"><a href="modules.html#hook" class="tsd-kind-icon">hook</a></li><li class="tsd-kind-function"><a href="modules.html#isEqual" class="tsd-kind-icon">is<wbr/>Equal</a></li><li class="tsd-kind-function"><a href="modules.html#isPromiseLike" class="tsd-kind-icon">is<wbr/>Promise<wbr/>Like</a></li><li class="tsd-kind-function"><a href="modules.html#mapDescriptors" class="tsd-kind-icon">map<wbr/>Descriptors</a></li><li class="tsd-kind-function"><a href="modules.html#mapValues" class="tsd-kind-icon">map<wbr/>Values</a></li><li class="tsd-kind-function"><a href="modules.html#normalizeContext" class="tsd-kind-icon">normalize<wbr/>Context</a></li><li class="tsd-kind-function"><a href="modules.html#normalizePipeline" class="tsd-kind-icon">normalize<wbr/>Pipeline</a></li><li class="tsd-kind-function"><a href="modules.html#patchExecutor" class="tsd-kind-icon">patch<wbr/>Executor</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#unboxValue" class="tsd-kind-icon">unbox<wbr/>Value</a></li></ul></nav></div></div></div><footer class=""><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="overlay"></div><script src="assets/main.js"></script></body></html>